from django.core.management.base import BaseCommand
from api.models import Test, Question, Answer, PsyToolkitTest

class Command(BaseCommand):
    help = '–ü–æ–ª–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏, –≤–æ–ø—Ä–æ—Å–∞–º–∏ –∏ –æ—Ç–≤–µ—Ç–∞–º–∏'

    def handle(self, *args, **options):
        self.stdout.write('–ü–æ–ª–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–≤—è–∑–µ–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö...')
        
        # –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª–∏–º –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã
        self.stdout.write('–£–¥–∞–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤...')
        Answer.objects.all().delete()
        Question.objects.all().delete()
        
        # –°–ª–æ–≤–∞—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π —Ç–µ—Å—Ç–æ–≤ –∏ –≤–æ–ø—Ä–æ—Å–æ–≤ —Å –æ—Ç–≤–µ—Ç–∞–º–∏
        test_data = {
            'Big Five Personality Test': {
                'questions': [
                    {
                        'text': '–Ø –ª–µ–≥–∫–æ –∑–Ω–∞–∫–æ–º–ª—é—Å—å —Å –Ω–æ–≤—ã–º–∏ –ª—é–¥—å–º–∏',
                        'answers': [
                            {'text': '–ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ —Å–æ–≥–ª–∞—Å–µ–Ω', 'value': 1},
                            {'text': '–ù–µ —Å–æ–≥–ª–∞—Å–µ–Ω', 'value': 2},
                            {'text': '–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ', 'value': 3},
                            {'text': '–°–æ–≥–ª–∞—Å–µ–Ω', 'value': 4},
                            {'text': '–ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≥–ª–∞—Å–µ–Ω', 'value': 5}
                        ]
                    },
                    {
                        'text': '–Ø –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–µ',
                        'answers': [
                            {'text': '–ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ —Å–æ–≥–ª–∞—Å–µ–Ω', 'value': 5},
                            {'text': '–ù–µ —Å–æ–≥–ª–∞—Å–µ–Ω', 'value': 4},
                            {'text': '–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ', 'value': 3},
                            {'text': '–°–æ–≥–ª–∞—Å–µ–Ω', 'value': 2},
                            {'text': '–ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≥–ª–∞—Å–µ–Ω', 'value': 1}
                        ]
                    },
                    {
                        'text': '–Ø –ª—é–±–ª—é –ø—Ä–æ–±–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –≤–µ—â–∏',
                        'answers': [
                            {'text': '–ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ —Å–æ–≥–ª–∞—Å–µ–Ω', 'value': 1},
                            {'text': '–ù–µ —Å–æ–≥–ª–∞—Å–µ–Ω', 'value': 2},
                            {'text': '–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ', 'value': 3},
                            {'text': '–°–æ–≥–ª–∞—Å–µ–Ω', 'value': 4},
                            {'text': '–ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≥–ª–∞—Å–µ–Ω', 'value': 5}
                        ]
                    },
                    {
                        'text': '–Ø –≤—Å–µ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è—é —Å–≤–æ–∏ –æ–±–µ—â–∞–Ω–∏—è',
                        'answers': [
                            {'text': '–ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ —Å–æ–≥–ª–∞—Å–µ–Ω', 'value': 1},
                            {'text': '–ù–µ —Å–æ–≥–ª–∞—Å–µ–Ω', 'value': 2},
                            {'text': '–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ', 'value': 3},
                            {'text': '–°–æ–≥–ª–∞—Å–µ–Ω', 'value': 4},
                            {'text': '–ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≥–ª–∞—Å–µ–Ω', 'value': 5}
                        ]
                    },
                    {
                        'text': '–Ø —á–∞—Å—Ç–æ –±–µ—Å–ø–æ–∫–æ—é—Å—å –æ –±—É–¥—É—â–µ–º',
                        'answers': [
                            {'text': '–ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ —Å–æ–≥–ª–∞—Å–µ–Ω', 'value': 5},
                            {'text': '–ù–µ —Å–æ–≥–ª–∞—Å–µ–Ω', 'value': 4},
                            {'text': '–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ', 'value': 3},
                            {'text': '–°–æ–≥–ª–∞—Å–µ–Ω', 'value': 2},
                            {'text': '–ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≥–ª–∞—Å–µ–Ω', 'value': 1}
                        ]
                    }
                ]
            },
            'MBTI Personality Assessment': {
                'questions': [
                    {
                        'text': '–í –∫–æ–º–ø–∞–Ω–∏–∏ —è –æ–±—ã—á–Ω–æ:',
                        'answers': [
                            {'text': '–†–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞—é —Å–æ –º–Ω–æ–≥–∏–º–∏ –ª—é–¥—å–º–∏', 'value': 5},
                            {'text': '–†–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞—é —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∑–Ω–∞–∫–æ–º—ã–º–∏', 'value': 3},
                            {'text': '–°–ª—É—à–∞—é –∏ –Ω–∞–±–ª—é–¥–∞—é', 'value': 1}
                        ]
                    },
                    {
                        'text': '–ü—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ —Ä–µ—à–µ–Ω–∏–π —è –±–æ–ª—å—à–µ –ø–æ–ª–∞–≥–∞—é—Å—å –Ω–∞:',
                        'answers': [
                            {'text': '–õ–æ–≥–∏–∫—É –∏ —Ñ–∞–∫—Ç—ã', 'value': 5},
                            {'text': '–ß—É–≤—Å—Ç–≤–∞ –∏ —Ü–µ–Ω–Ω–æ—Å—Ç–∏', 'value': 1}
                        ]
                    },
                    {
                        'text': '–Ø –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞—Ä–∞–Ω–µ–µ:',
                        'answers': [
                            {'text': '–î–∞, —è –ª—é–±–ª—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É', 'value': 5},
                            {'text': '–ù–µ—Ç, —è –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç—å', 'value': 1}
                        ]
                    }
                ]
            },
            'Raven\'s Progressive Matrices': {
                'questions': [
                    {
                        'text': '–ö–∞–∫–∞—è —Ñ–∏–≥—É—Ä–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞ –º–µ—Å—Ç–µ –∑–Ω–∞–∫–∞ –≤–æ–ø—Ä–æ—Å–∞?',
                        'answers': [
                            {'text': '–ö—Ä—É–≥', 'value': 5, 'is_correct': True},
                            {'text': '–ö–≤–∞–¥—Ä–∞—Ç', 'value': 0, 'is_correct': False},
                            {'text': '–¢—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫', 'value': 0, 'is_correct': False}
                        ]
                    },
                    {
                        'text': '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 2, 4, 8, 16, ?',
                        'answers': [
                            {'text': '24', 'value': 0, 'is_correct': False},
                            {'text': '32', 'value': 5, 'is_correct': True},
                            {'text': '30', 'value': 0, 'is_correct': False}
                        ]
                    },
                    {
                        'text': '–ï—Å–ª–∏ –≤—Å–µ —Ä–æ–∑—ã - —Ü–≤–µ—Ç—ã, –∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ü–≤–µ—Ç—ã –±—ã—Å—Ç—Ä–æ —É–≤—è–¥–∞—é—Ç, —Ç–æ:',
                        'answers': [
                            {'text': '–í—Å–µ —Ä–æ–∑—ã –±—ã—Å—Ç—Ä–æ —É–≤—è–¥–∞—é—Ç', 'value': 0, 'is_correct': False},
                            {'text': '–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–æ–∑—ã –±—ã—Å—Ç—Ä–æ —É–≤—è–¥–∞—é—Ç', 'value': 5, 'is_correct': True},
                            {'text': '–ù–∏ –æ–¥–Ω–∞ —Ä–æ–∑–∞ –Ω–µ —É–≤—è–¥–∞–µ—Ç –±—ã—Å—Ç—Ä–æ', 'value': 0, 'is_correct': False}
                        ]
                    }
                ]
            },
            'Beck Depression Inventory': {
                'questions': [
                    {
                        'text': '–ö–∞–∫ —á–∞—Å—Ç–æ –≤—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ –≥—Ä—É—Å—Ç—å?',
                        'answers': [
                            {'text': '–ù–∏–∫–æ–≥–¥–∞', 'value': 0},
                            {'text': '–†–µ–¥–∫–æ', 'value': 1},
                            {'text': '–ò–Ω–æ–≥–¥–∞', 'value': 2},
                            {'text': '–ß–∞—Å—Ç–æ', 'value': 3},
                            {'text': '–ü–æ—Å—Ç–æ—è–Ω–Ω–æ', 'value': 4}
                        ]
                    },
                    {
                        'text': '–ö–∞–∫ –≤—ã –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç–µ —Å–≤–æ–π —Å–æ–Ω?',
                        'answers': [
                            {'text': '–û—Ç–ª–∏—á–Ω–æ', 'value': 0},
                            {'text': '–•–æ—Ä–æ—à–æ', 'value': 1},
                            {'text': '–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ', 'value': 2},
                            {'text': '–ü–ª–æ—Ö–æ', 'value': 3},
                            {'text': '–û—á–µ–Ω—å –ø–ª–æ—Ö–æ', 'value': 4}
                        ]
                    },
                    {
                        'text': '–ö–∞–∫ –≤—ã –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç–µ —Å–≤–æ–π –∞–ø–ø–µ—Ç–∏—Ç?',
                        'answers': [
                            {'text': '–û—Ç–ª–∏—á–Ω–æ', 'value': 0},
                            {'text': '–•–æ—Ä–æ—à–æ', 'value': 1},
                            {'text': '–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ', 'value': 2},
                            {'text': '–ü–ª–æ—Ö–æ', 'value': 3},
                            {'text': '–û—á–µ–Ω—å –ø–ª–æ—Ö–æ', 'value': 4}
                        ]
                    }
                ]
            }
        }
        
        fixed_count = 0
        
        for test_name, test_info in test_data.items():
            try:
                # –ù–∞—Ö–æ–¥–∏–º —Ç–µ—Å—Ç
                test = Test.objects.filter(name__icontains=test_name[:20]).first()
                if not test:
                    self.stdout.write(f'‚ùå –¢–µ—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω: {test_name}')
                    continue
                
                self.stdout.write(f'üîß –ò—Å–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç: {test.name}')
                
                # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã –¥–ª—è —ç—Ç–æ–≥–æ —Ç–µ—Å—Ç–∞
                for i, question_data in enumerate(test_info['questions']):
                    # –°–æ–∑–¥–∞–µ–º –≤–æ–ø—Ä–æ—Å
                    question = Question.objects.create(
                        test=test,
                        text=question_data['text'],
                        order=i + 1,
                        question_type='likert' if len(question_data['answers']) > 3 else 'choice'
                    )
                    
                    # –°–æ–∑–¥–∞–µ–º –æ—Ç–≤–µ—Ç—ã
                    for answer_data in question_data['answers']:
                        Answer.objects.create(
                            question=question,
                            text=answer_data['text'],
                            value=answer_data['value'],
                            personality_trait='personality_trait',  # –ó–∞–≥–ª—É—à–∫–∞
                            is_correct=answer_data.get('is_correct', False)
                        )
                    
                    self.stdout.write(f'  ‚úì –°–æ–∑–¥–∞–Ω –≤–æ–ø—Ä–æ—Å: {question.text[:50]}...')
                    fixed_count += 1
                
            except Exception as e:
                self.stdout.write(f'‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —Ç–µ—Å—Ç–∞ {test_name}: {e}')
        
        self.stdout.write(
            self.style.SUCCESS(f'–í—Å–µ —Å–≤—è–∑–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã! –°–æ–∑–¥–∞–Ω–æ: {fixed_count} –≤–æ–ø—Ä–æ—Å–æ–≤')
        )
