# Интеграция с PsyToolkit

Этот документ описывает интеграцию проекта MindJourney с базой психологических тестов PsyToolkit.

## Обзор

PsyToolkit - это платформа для создания и проведения психологических экспериментов и тестов. Наша интеграция позволяет:

- Поиск и просмотр доступных тестов из базы PsyToolkit
- Импорт тестов в локальную базу данных
- Синхронизация метаданных тестов
- Управление импортированными тестами

## Архитектура

### Модели данных

#### PsyToolkitTest
Основная модель для хранения информации о тестах из PsyToolkit:
- `name` - название теста
- `description` - описание теста
- `psy_toolkit_id` - уникальный ID в PsyToolkit
- `author` - автор теста
- `category` - категория теста
- `tags` - теги для классификации
- `raw_data` - сырые данные из PsyToolkit
- `is_imported` - статус импорта
- `imported_test` - связь с локальным тестом

#### PsyToolkitImportLog
Логирование процесса импорта:
- `psy_toolkit_test` - ссылка на тест PsyToolkit
- `imported_test` - ссылка на импортированный тест
- `import_date` - дата импорта
- `status` - статус операции
- `details` - детали импорта
- `imported_by` - пользователь, выполнивший импорт

### Расширенные поля в существующих моделях

#### Test
- `source` - источник теста ('custom' или 'psytoolkit')
- `psy_toolkit_id` - ID в PsyToolkit
- `psy_toolkit_data` - данные PsyToolkit
- `test_type` - тип теста
- `estimated_duration` - примерная длительность
- `difficulty_level` - уровень сложности

#### Question
- `question_type` - тип вопроса
- `psy_toolkit_data` - данные PsyToolkit
- `required` - обязательность вопроса

#### Answer
- `psy_toolkit_data` - данные PsyToolkit
- `is_correct` - правильность ответа

## API Endpoints

### PsyToolkit API

#### GET /api/psytoolkit/tests/
Получение списка тестов PsyToolkit с фильтрацией:
- `category` - фильтр по категории
- `is_imported` - фильтр по статусу импорта
- `search` - поиск по названию/описанию

#### GET /api/psytoolkit/search/
Поиск тестов в PsyToolkit:
- `q` - поисковый запрос
- `category` - категория
- `limit` - количество результатов

#### GET /api/psytoolkit/tests/{test_id}/details/
Получение детальной информации о тесте

#### POST /api/psytoolkit/import/
Импорт теста из PsyToolkit:
```json
{
  "test_id": "psy_toolkit_test_id"
}
```

#### POST /api/psytoolkit/sync/
Синхронизация доступных тестов:
```json
{
  "categories": ["personality", "cognitive", "clinical"]
}
```

#### GET /api/psytoolkit/categories/
Получение доступных категорий

#### GET /api/psytoolkit/statistics/
Получение статистики по PsyToolkit тестам

#### GET /api/psytoolkit/logs/
Получение логов импорта

## Использование

### 1. Синхронизация тестов

Для начала работы необходимо синхронизировать доступные тесты:

```bash
# Синхронизация всех категорий
python manage.py import_psytoolkit_tests

# Синхронизация конкретной категории
python manage.py import_psytoolkit_tests --category personality

# Синхронизация нескольких категорий
python manage.py import_psytoolkit_tests --categories personality cognitive clinical

# Только синхронизация без импорта
python manage.py import_psytoolkit_tests --sync-only
```

### 2. Импорт тестов

```bash
# Импорт конкретного теста
python manage.py import_psytoolkit_tests --test-id "test_id_here"

# Импорт всех доступных тестов
python manage.py import_psytoolkit_tests --import-all

# Импорт с ограничением количества
python manage.py import_psytoolkit_tests --import-all --limit 10
```

### 3. Использование через веб-интерфейс

1. Перейдите на страницу `/psytoolkit`
2. Используйте поиск и фильтры для нахождения нужных тестов
3. Нажмите "Синхронизировать" для обновления списка тестов
4. Нажмите "Импортировать" для импорта конкретного теста

## Категории тестов

Поддерживаемые категории:
- `personality` - Личностные тесты
- `cognitive` - Когнитивные тесты
- `clinical` - Клинические тесты
- `neuropsychological` - Нейропсихологические тесты
- `social` - Социальные тесты
- `educational` - Образовательные тесты
- `workplace` - Рабочие тесты

## Типы тестов

Автоматически определяемые типы:
- `personality` - тесты личности (Big5, MBTI, etc.)
- `cognitive` - когнитивные тесты (интеллект, память)
- `clinical` - клинические тесты (депрессия, тревожность)
- `neuropsychological` - нейропсихологические тесты
- `general` - общие тесты

## Уровни сложности

- `easy` - простые тесты (5-10 минут)
- `medium` - средние тесты (10-30 минут)
- `hard` - сложные тесты (30+ минут)

## Мониторинг и логирование

Все операции импорта логируются в `PsyToolkitImportLog`:
- Успешные импорты
- Ошибки импорта
- Детали операций
- Пользователи, выполнившие импорт

## Безопасность

- Все API endpoints требуют аутентификации
- Логирование всех операций импорта
- Валидация данных перед импортом
- Проверка на дублирование тестов

## Ограничения

- PsyToolkit API может иметь ограничения на количество запросов
- Некоторые тесты могут быть недоступны для импорта
- Формат данных может отличаться между тестами

## Устранение неполадок

### Ошибки подключения к PsyToolkit
1. Проверьте интернет-соединение
2. Убедитесь, что PsyToolkit API доступен
3. Проверьте логи Django для деталей ошибки

### Ошибки импорта
1. Проверьте формат данных теста
2. Убедитесь, что все обязательные поля заполнены
3. Проверьте логи импорта в админ-панели

### Проблемы с производительностью
1. Ограничьте количество одновременно импортируемых тестов
2. Используйте фильтры по категориям
3. Мониторьте использование памяти

## Разработка

### Добавление новых типов тестов

1. Обновите метод `_determine_test_type` в `PsyToolkitService`
2. Добавьте новые категории в API
3. Обновите фронтенд для поддержки новых типов

### Расширение функциональности

1. Добавьте новые поля в модели при необходимости
2. Создайте миграции для изменений схемы
3. Обновите сериализаторы и API endpoints
4. Протестируйте изменения

## Контакты

Для вопросов по интеграции с PsyToolkit обращайтесь к команде разработки.
